import{d as ts,r as k,p as F,c as T,a as o,b as s,h as n,i as j,v as V,q as as,e as ns,F as A,s as C,t as u,o as i,x as w,f as D,_ as L,y as q,z as is,A as os,B as K,C as G,D as B,l as U,m as ls,u as rs}from"./index-D8wTVrpd.js";import{a as ds,b as cs}from"./adminServices-UsykoH-M.js";const ms={class:"card"},us={class:"card-body"},gs={class:"row mb-3"},vs={class:"col-md-6"},ys={class:"col-md-6"},fs={class:"row"},ps={class:"col-12"},bs={class:"symptom-grid"},hs={class:"form-check"},_s=["id","value","onChange"],ws=["for"],Ds={class:"text-muted d-block"},As={key:0,class:"severity-selector mt-2"},Cs=["value","onChange"],ks={class:"mt-4"},xs={class:"selected-symptoms"},Ss=["onClick"],$s={class:"d-flex justify-content-end mt-4"},Rs=["disabled"],Ps=ts({__name:"SymptomSelector",props:{selectedSymptoms:{}},emits:["update:symptoms","next"],setup(y,{emit:e}){const l=y,t=e,f=k(""),v=k(""),a=k([]);F(async()=>{const d=await ds.listSymptoms();a.value=d.map(r=>({...r,system:r.system||"",description:r.description||""}))});const g=T(()=>a.value.filter(d=>{const r=d.name.toLowerCase().includes(f.value.toLowerCase())||(d.description||"").toLowerCase().includes(f.value.toLowerCase()),c=!v.value||(d.system||"").toLowerCase()===v.value.toLowerCase();return r&&c}));function b(d){return l.selectedSymptoms.some(r=>r.id===d)}function x(d){const r=l.selectedSymptoms.find(c=>c.id===d);return r?r.severity:"leve"}function S(d){const r=[...l.selectedSymptoms],c=r.findIndex($=>$.id===d.id);c>-1?r.splice(c,1):r.push({id:d.id,name:d.name,description:d.description,category:d.system,severity:"leve"}),t("update:symptoms",r)}function z(d,r){const c=[...l.selectedSymptoms],$=c.findIndex(p=>p.id===d);$>-1&&(c[$].severity=r,t("update:symptoms",c))}function h(d){const r=l.selectedSymptoms.filter(c=>c.id!==d);t("update:symptoms",r)}function E(){t("next")}return(d,r)=>(i(),o("div",ms,[r[6]||(r[6]=s("div",{class:"card-header bg-primary text-white"},[s("h5",{class:"mb-0"},[s("i",{class:"fas fa-stethoscope me-2"}),n(" Selección de Síntomas ")])],-1)),s("div",us,[s("div",gs,[s("div",vs,[j(s("input",{type:"text",class:"form-control",placeholder:"Buscar síntomas...","onUpdate:modelValue":r[0]||(r[0]=c=>f.value=c)},null,512),[[V,f.value]])]),s("div",ys,[j(s("select",{class:"form-select","onUpdate:modelValue":r[1]||(r[1]=c=>v.value=c)},[...r[2]||(r[2]=[ns('<option value="" data-v-7af66a2b>Todas las categorías</option><option value="general" data-v-7af66a2b>Síntomas Generales</option><option value="respiratorio" data-v-7af66a2b>Sistema Respiratorio</option><option value="digestivo" data-v-7af66a2b>Sistema Digestivo</option><option value="neurologico" data-v-7af66a2b>Sistema Neurológico</option><option value="cardiovascular" data-v-7af66a2b>Sistema Cardiovascular</option>',6)])],512),[[as,v.value]])])]),s("div",fs,[s("div",ps,[s("div",bs,[(i(!0),o(A,null,C(g.value,c=>(i(),o("div",{key:c.id,class:w(["symptom-card",{selected:b(c.id)}])},[s("div",hs,[s("input",{class:"form-check-input",type:"checkbox",id:"symptom-"+c.id,value:c.id,onChange:$=>S(c)},null,40,_s),s("label",{class:"form-check-label",for:"symptom-"+c.id},[s("strong",null,u(c.name),1),s("small",Ds,u(c.description),1)],8,ws)]),b(c.id)?(i(),o("div",As,[r[4]||(r[4]=s("label",{class:"form-label small"},"Nivel de severidad:",-1)),s("select",{class:"form-select form-select-sm",value:x(c.id),onChange:$=>z(c.id,$.target.value)},[...r[3]||(r[3]=[s("option",{value:"leve"},"Leve",-1),s("option",{value:"moderado"},"Moderado",-1),s("option",{value:"severo"},"Severo",-1)])],40,Cs)])):D("",!0)],2))),128))])])]),s("div",ks,[s("h6",null,"Síntomas Seleccionados ("+u(d.selectedSymptoms.length)+")",1),s("div",xs,[(i(!0),o(A,null,C(d.selectedSymptoms,c=>(i(),o("span",{key:c.id,class:"badge bg-primary me-2 mb-2"},[n(u(c.name)+" - "+u(c.severity)+" ",1),s("button",{type:"button",class:"btn-close btn-close-white ms-2",onClick:$=>h(c.id)},null,8,Ss)]))),128))])]),s("div",$s,[s("button",{class:"btn btn-primary",disabled:d.selectedSymptoms.length===0,onClick:E},[...r[5]||(r[5]=[n(" Continuar ",-1),s("i",{class:"fas fa-arrow-right ms-2"},null,-1)])],8,Rs)])])]))}}),zs=L(Ps,[["__scopeId","data-v-7af66a2b"]]),Is={name:"MedicalHistory",props:{allergies:{type:Array,default:()=>[]},chronicDiseases:{type:Array,default:()=>[]}},emits:["update:allergies","update:chronicDiseases","next","previous"],setup(y,{emit:e}){const l=k(""),t=k(""),f=T({get:()=>y.allergies,set:d=>e("update:allergies",d)}),v=T({get:()=>y.chronicDiseases,set:d=>e("update:chronicDiseases",d)});return{newAllergy:l,newChronicDisease:t,currentAllergies:f,currentChronicDiseases:v,commonChronicDiseases:[{id:1,name:"Diabetes",description:"Diabetes tipo 1 o 2"},{id:2,name:"Hipertensión",description:"Presión arterial alta"},{id:3,name:"Asma",description:"Enfermedad respiratoria crónica"},{id:4,name:"Artritis",description:"Inflamación de las articulaciones"},{id:5,name:"Enfermedad Cardíaca",description:"Problemas del corazón"},{id:6,name:"Enfermedad Renal",description:"Problemas de riñones"},{id:7,name:"Enfermedad Hepática",description:"Problemas del hígado"},{id:8,name:"Tiroides",description:"Problemas de tiroides"},{id:9,name:"Epilepsia",description:"Trastorno neurológico"},{id:10,name:"Enfermedad Autoinmune",description:"Sistema inmune alterado"}],addAllergy:()=>{if(l.value.trim()&&!f.value.includes(l.value.trim())){const d=[...f.value,l.value.trim()];e("update:allergies",d),l.value=""}},removeAllergy:d=>{const r=f.value.filter((c,$)=>$!==d);e("update:allergies",r)},toggleChronicDisease:d=>{const r=v.value.includes(d)?v.value.filter(c=>c!==d):[...v.value,d];e("update:chronicDiseases",r)},addChronicDisease:()=>{if(t.value.trim()&&!v.value.includes(t.value.trim())){const d=[...v.value,t.value.trim()];e("update:chronicDiseases",d),t.value=""}},removeChronicDisease:d=>{const r=v.value.filter(c=>c!==d);e("update:chronicDiseases",r)},goBack:()=>{e("previous")},proceedToNext:()=>{e("next")}}}},Hs={class:"card"},Ls={class:"card-body"},Ns={class:"mb-4"},Ms={class:"row"},Bs={class:"col-md-8"},Us={class:"col-md-4"},Es=["disabled"],js={key:0,class:"mt-3"},Ts={class:"d-flex flex-wrap gap-2"},Vs=["onClick"],Os={key:1,class:"alert alert-info mt-3"},qs={class:"mb-4"},Fs={class:"row"},Ks={class:"col-md-12"},Gs={class:"chronic-diseases-grid"},Js=["id","value","checked","onChange"],Qs=["for"],Ws={class:"text-muted d-block"},Xs={class:"mt-3"},Ys={class:"row"},Zs={class:"col-md-8"},se={class:"col-md-4"},ee=["disabled"],te={key:0,class:"mt-3"},ae={class:"d-flex flex-wrap gap-2 mt-2"},ne=["onClick"],ie={class:"d-flex justify-content-between mt-4"};function oe(y,e,l,t,f,v){return i(),o("div",Hs,[e[22]||(e[22]=s("div",{class:"card-header bg-warning text-dark"},[s("h5",{class:"mb-0"},[s("i",{class:"fas fa-history me-2"}),n(" Historial Médico ")])],-1)),s("div",Ls,[e[18]||(e[18]=n(" Alergias a Medicamentos ",-1)),s("div",Ns,[e[10]||(e[10]=s("h6",{class:"text-primary"},[s("i",{class:"fas fa-exclamation-triangle me-2"}),n(" Alergias a Medicamentos ")],-1)),s("div",Ms,[s("div",Bs,[j(s("input",{type:"text",class:"form-control",placeholder:"Ingrese medicamento al que es alérgico...","onUpdate:modelValue":e[0]||(e[0]=a=>t.newAllergy=a),onKeyup:e[1]||(e[1]=q((...a)=>t.addAllergy&&t.addAllergy(...a),["enter"]))},null,544),[[V,t.newAllergy]])]),s("div",Us,[s("button",{class:"btn btn-outline-primary w-100",onClick:e[2]||(e[2]=(...a)=>t.addAllergy&&t.addAllergy(...a)),disabled:!t.newAllergy.trim()},[...e[8]||(e[8]=[s("i",{class:"fas fa-plus me-1"},null,-1),n(" Agregar ",-1)])],8,Es)])]),t.currentAllergies.length>0?(i(),o("div",js,[s("div",Ts,[(i(!0),o(A,null,C(t.currentAllergies,(a,g)=>(i(),o("span",{key:g,class:"badge bg-danger"},[n(u(a)+" ",1),s("button",{type:"button",class:"btn-close btn-close-white ms-2",onClick:b=>t.removeAllergy(g)},null,8,Vs)]))),128))])])):(i(),o("div",Os,[...e[9]||(e[9]=[s("small",null,[s("i",{class:"fas fa-info-circle me-1"}),n(" No se han registrado alergias a medicamentos. ")],-1)])]))]),e[19]||(e[19]=s("hr",null,null,-1)),e[20]||(e[20]=n(" Enfermedades Crónicas ",-1)),s("div",qs,[e[14]||(e[14]=s("h6",{class:"text-primary"},[s("i",{class:"fas fa-heartbeat me-2"}),n(" Enfermedades Crónicas Preexistentes ")],-1)),s("div",Fs,[s("div",Ks,[s("div",Gs,[(i(!0),o(A,null,C(t.commonChronicDiseases,a=>(i(),o("div",{key:a.id,class:"form-check chronic-disease-item"},[s("input",{class:"form-check-input",type:"checkbox",id:"chronic-"+a.id,value:a.name,checked:t.currentChronicDiseases.includes(a.name),onChange:g=>t.toggleChronicDisease(a.name)},null,40,Js),s("label",{class:"form-check-label",for:"chronic-"+a.id},[s("strong",null,u(a.name),1),s("small",Ws,u(a.description),1)],8,Qs)]))),128))])])]),e[15]||(e[15]=n(" Otras enfermedades crónicas ",-1)),s("div",Xs,[e[12]||(e[12]=s("label",{class:"form-label"},"Otras enfermedades crónicas no listadas:",-1)),s("div",Ys,[s("div",Zs,[j(s("input",{type:"text",class:"form-control",placeholder:"Ingrese otra enfermedad crónica...","onUpdate:modelValue":e[3]||(e[3]=a=>t.newChronicDisease=a),onKeyup:e[4]||(e[4]=q((...a)=>t.addChronicDisease&&t.addChronicDisease(...a),["enter"]))},null,544),[[V,t.newChronicDisease]])]),s("div",se,[s("button",{class:"btn btn-outline-primary w-100",onClick:e[5]||(e[5]=(...a)=>t.addChronicDisease&&t.addChronicDisease(...a)),disabled:!t.newChronicDisease.trim()},[...e[11]||(e[11]=[s("i",{class:"fas fa-plus me-1"},null,-1),n(" Agregar ",-1)])],8,ee)])])]),t.currentChronicDiseases.length>0?(i(),o("div",te,[e[13]||(e[13]=s("strong",null,"Enfermedades seleccionadas:",-1)),s("div",ae,[(i(!0),o(A,null,C(t.currentChronicDiseases,(a,g)=>(i(),o("span",{key:g,class:"badge bg-warning text-dark"},[n(u(a)+" ",1),s("button",{type:"button",class:"btn-close ms-2",onClick:b=>t.removeChronicDisease(a)},null,8,ne)]))),128))])])):D("",!0)]),e[21]||(e[21]=n(" Navegación ",-1)),s("div",ie,[s("button",{class:"btn btn-outline-secondary",onClick:e[6]||(e[6]=(...a)=>t.goBack&&t.goBack(...a))},[...e[16]||(e[16]=[s("i",{class:"fas fa-arrow-left me-2"},null,-1),n(" Anterior ",-1)])]),s("button",{class:"btn btn-primary",onClick:e[7]||(e[7]=(...a)=>t.proceedToNext&&t.proceedToNext(...a))},[...e[17]||(e[17]=[n(" Continuar ",-1),s("i",{class:"fas fa-arrow-right ms-2"},null,-1)])])])])])}const le=L(Is,[["render",oe],["__scopeId","data-v-4ebe8fcc"]]),re={name:"DiagnosisAnalysis",props:{patientData:{type:Object,required:!0},isAnalyzing:{type:Boolean,default:!1}},emits:["analyze","previous"],setup(y,{emit:e}){const l=k(0),t=k(0);let f=null;const v=S=>{switch(S){case"leve":return"severity-mild";case"moderado":return"severity-moderate";case"severo":return"severity-severe";default:return"severity-mild"}};function a(){f&&(clearInterval(f),f=null)}const g=()=>{e("analyze")},b=()=>{e("previous")};F(()=>{y.isAnalyzing&&x()}),is(()=>y.isAnalyzing,S=>{S?x():a()});const x=()=>{l.value=0,t.value=0,f=setInterval(()=>{t.value<100&&(t.value+=2,t.value>=20&&(l.value=1),t.value>=40&&(l.value=2),t.value>=60&&(l.value=3),t.value>=80&&(l.value=4),t.value>=100&&(l.value=5))},60)};return os(()=>{a()}),y.isAnalyzing&&x(),{currentStep:l,progressPercentage:t,getSeverityClass:v,startAnalysis:g,goBack:b}}},de={class:"card"},ce={class:"card-body"},me={class:"row mb-4"},ue={class:"col-md-4"},ge={class:"summary-card"},ve={class:"summary-content"},ye={class:"h4"},fe={class:"col-md-4"},pe={class:"summary-card"},be={class:"summary-content"},he={class:"h4"},_e={class:"col-md-4"},we={class:"summary-card"},De={class:"summary-content"},Ae={class:"h4"},Ce={class:"mb-4"},ke={class:"symptoms-summary"},xe={class:"severity-label"},Se={key:0,class:"row mb-4"},$e={key:0,class:"col-md-6"},Re={class:"list-unstyled"},Pe={key:1,class:"col-md-6"},ze={class:"list-unstyled"},Ie={class:"text-center"},He={key:0,class:"mb-3"},Le={key:1,class:"analysis-progress"},Ne={class:"progress mb-3"},Me={class:"analysis-steps"},Be={key:1,class:"d-flex justify-content-between mt-4"};function Ue(y,e,l,t,f,v){return i(),o("div",de,[e[28]||(e[28]=s("div",{class:"card-header bg-info text-white"},[s("h5",{class:"mb-0"},[s("i",{class:"fas fa-search me-2"}),n(" Análisis Diagnóstico ")])],-1)),s("div",ce,[e[23]||(e[23]=n(" Resumen de datos ingresados ",-1)),s("div",me,[s("div",ue,[s("div",ge,[e[3]||(e[3]=s("div",{class:"summary-icon bg-primary"},[s("i",{class:"fas fa-stethoscope"})],-1)),s("div",ve,[e[2]||(e[2]=s("h6",null,"Síntomas",-1)),s("span",ye,u(l.patientData.symptoms.length),1)])])]),s("div",fe,[s("div",pe,[e[5]||(e[5]=s("div",{class:"summary-icon bg-danger"},[s("i",{class:"fas fa-exclamation-triangle"})],-1)),s("div",be,[e[4]||(e[4]=s("h6",null,"Alergias",-1)),s("span",he,u(l.patientData.allergies.length),1)])])]),s("div",_e,[s("div",we,[e[7]||(e[7]=s("div",{class:"summary-icon bg-warning"},[s("i",{class:"fas fa-heartbeat"})],-1)),s("div",De,[e[6]||(e[6]=s("h6",null,"Enf. Crónicas",-1)),s("span",Ae,u(l.patientData.chronicDiseases.length),1)])])])]),e[24]||(e[24]=n(" Detalles de síntomas ",-1)),s("div",Ce,[e[8]||(e[8]=s("h6",{class:"text-primary"},"Síntomas Reportados:",-1)),s("div",ke,[(i(!0),o(A,null,C(l.patientData.symptoms,a=>(i(),o("div",{key:a.id,class:w(["symptom-badge",t.getSeverityClass(a.severity)])},[s("strong",null,u(a.name),1),s("small",xe,u(a.severity),1)],2))),128))])]),e[25]||(e[25]=n(" Alergias y enfermedades crónicas ",-1)),l.patientData.allergies.length>0||l.patientData.chronicDiseases.length>0?(i(),o("div",Se,[l.patientData.allergies.length>0?(i(),o("div",$e,[e[10]||(e[10]=s("h6",{class:"text-danger"},"Alergias a Medicamentos:",-1)),s("ul",Re,[(i(!0),o(A,null,C(l.patientData.allergies,a=>(i(),o("li",{key:a,class:"mb-1"},[e[9]||(e[9]=s("i",{class:"fas fa-exclamation-circle text-danger me-2"},null,-1)),n(" "+u(a),1)]))),128))])])):D("",!0),l.patientData.chronicDiseases.length>0?(i(),o("div",Pe,[e[12]||(e[12]=s("h6",{class:"text-warning"},"Enfermedades Crónicas:",-1)),s("ul",ze,[(i(!0),o(A,null,C(l.patientData.chronicDiseases,a=>(i(),o("li",{key:a,class:"mb-1"},[e[11]||(e[11]=s("i",{class:"fas fa-heartbeat text-warning me-2"},null,-1)),n(" "+u(a),1)]))),128))])])):D("",!0)])):D("",!0),e[26]||(e[26]=n(" Botón de análisis ",-1)),s("div",Ie,[l.isAnalyzing?(i(),o("div",Le,[e[20]||(e[20]=s("div",{class:"spinner-border text-primary mb-3",role:"status"},[s("span",{class:"visually-hidden"},"Analizando...")],-1)),e[21]||(e[21]=s("h5",{class:"text-primary"},"Analizando datos...",-1)),s("div",Ne,[s("div",{class:"progress-bar progress-bar-striped progress-bar-animated",style:K({width:t.progressPercentage+"%"})},null,4)]),s("div",Me,[s("div",{class:w(["step",{completed:t.currentStep>=1}])},[...e[15]||(e[15]=[s("i",{class:"fas fa-check-circle"},null,-1),n(" Procesando síntomas ",-1)])],2),s("div",{class:w(["step",{completed:t.currentStep>=2}])},[...e[16]||(e[16]=[s("i",{class:"fas fa-check-circle"},null,-1),n(" Ejecutando reglas Prolog ",-1)])],2),s("div",{class:w(["step",{completed:t.currentStep>=3}])},[...e[17]||(e[17]=[s("i",{class:"fas fa-check-circle"},null,-1),n(" Calculando afinidades ",-1)])],2),s("div",{class:w(["step",{completed:t.currentStep>=4}])},[...e[18]||(e[18]=[s("i",{class:"fas fa-check-circle"},null,-1),n(" Verificando medicamentos ",-1)])],2),s("div",{class:w(["step",{completed:t.currentStep>=5}])},[...e[19]||(e[19]=[s("i",{class:"fas fa-check-circle"},null,-1),n(" Generando reporte ",-1)])],2)])])):(i(),o("div",He,[e[14]||(e[14]=s("div",{class:"alert alert-info"},[s("i",{class:"fas fa-info-circle me-2"}),n(" El sistema utilizará la base de conocimiento en Prolog para realizar un análisis de inferencia lógica y determinar posibles diagnósticos basados en los síntomas reportados. ")],-1)),s("button",{class:"btn btn-success btn-lg",onClick:e[0]||(e[0]=(...a)=>t.startAnalysis&&t.startAnalysis(...a))},[...e[13]||(e[13]=[s("i",{class:"fas fa-play me-2"},null,-1),n(" Iniciar Análisis Diagnóstico ",-1)])])]))]),e[27]||(e[27]=n(" Navegación ",-1)),l.isAnalyzing?D("",!0):(i(),o("div",Be,[s("button",{class:"btn btn-outline-secondary",onClick:e[1]||(e[1]=(...a)=>t.goBack&&t.goBack(...a))},[...e[22]||(e[22]=[s("i",{class:"fas fa-arrow-left me-2"},null,-1),n(" Anterior ",-1)])])]))])])}const Ee=L(re,[["render",Ue],["__scopeId","data-v-b4334a82"]]),je={name:"DiagnosisResults",props:{results:{type:Object,required:!0},patientData:{type:Object,required:!0}},emits:["new-analysis","download-report"],setup(y,{emit:e}){const l=G({});return{showRules:l,formatDate:h=>new Intl.DateTimeFormat("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(h),getUrgencyClass:h=>{switch(h){case"high":return"bg-danger";case"medium":return"bg-warning text-dark";case"low":return"bg-success";default:return"bg-secondary"}},getUrgencyCircleClass:h=>{switch(h){case"high":return"urgency-high";case"medium":return"urgency-medium";case"low":return"urgency-low";default:return"urgency-low"}},getUrgencyIcon:h=>{switch(h){case"high":return"fas fa-exclamation-triangle";case"medium":return"fas fa-clock";case"low":return"fas fa-eye";default:return"fas fa-info"}},getAffinityClass:h=>h>=80?"bg-danger":h>=60?"bg-warning":h>=40?"bg-info":"bg-success",toggleRules:h=>{l[h]=!l[h]},newAnalysis:()=>{e("new-analysis")},downloadReport:()=>{e("download-report")},shareResults:()=>{console.log("Compartiendo resultados...")}}}},Te={class:"card"},Ve={class:"card-body"},Oe={class:"alert alert-info mb-4"},qe={class:"row align-items-center"},Fe={class:"col-md-8"},Ke={class:"mb-0"},Ge={class:"col-md-4 text-end"},Je={class:"text-muted"},Qe={class:"diagnoses-list mb-4"},We={class:"card"},Xe={class:"card-body"},Ye={class:"row"},Ze={class:"col-md-8"},st={class:"d-flex align-items-center mb-2"},et={class:"diagnosis-rank me-3"},tt={class:"mb-0"},at={class:"affinity-bar mb-3"},nt={class:"d-flex justify-content-between align-items-center mb-1"},it={class:"text-primary"},ot={class:"progress"},lt={class:"medications mb-2"},rt={class:"mt-1"},dt={class:"activated-rules"},ct=["onClick"],mt={key:0,class:"mt-2"},ut={class:"rules-container"},gt={class:"list-unstyled mt-1"},vt={class:"col-md-4 text-center"},yt={class:"urgency-indicator"},ft={class:"urgency-text mt-2"},pt={class:"d-flex justify-content-between align-items-center"};function bt(y,e,l,t,f,v){return i(),o("div",Te,[e[21]||(e[21]=s("div",{class:"card-header bg-success text-white"},[s("h5",{class:"mb-0"},[s("i",{class:"fas fa-clipboard-list me-2"}),n(" Resultados del Análisis Diagnóstico ")])],-1)),s("div",Ve,[e[16]||(e[16]=n(" Resumen general ",-1)),s("div",Oe,[s("div",qe,[s("div",Fe,[e[3]||(e[3]=s("h6",{class:"alert-heading mb-2"},[s("i",{class:"fas fa-info-circle me-2"}),n(" Análisis Completado ")],-1)),s("p",Ke," Se han identificado "+u(l.results.diseases.length)+" posibles diagnósticos basados en los síntomas reportados y el análisis de la base de conocimiento. ",1)]),s("div",Ge,[s("small",Je,[e[4]||(e[4]=s("i",{class:"fas fa-clock me-1"},null,-1)),n(" "+u(t.formatDate(l.results.timestamp)),1)])])])]),e[17]||(e[17]=n(" Lista de diagnósticos ",-1)),s("div",Qe,[e[12]||(e[12]=s("h6",{class:"text-primary mb-3"},"Diagnósticos Sugeridos (ordenados por afinidad):",-1)),(i(!0),o(A,null,C(l.results.diseases,(a,g)=>(i(),o("div",{key:g,class:"diagnosis-card mb-3"},[s("div",We,[s("div",Xe,[s("div",Ye,[s("div",Ze,[s("div",st,[s("span",et,u(g+1),1),s("h6",tt,u(a.name),1),s("span",{class:w(["badge ms-2",t.getUrgencyClass(a.urgencyLevel)])},u(a.urgency),3)]),e[9]||(e[9]=n(" Barra de afinidad ",-1)),s("div",at,[s("div",nt,[e[5]||(e[5]=s("small",{class:"text-muted"},"Porcentaje de afinidad:",-1)),s("strong",it,u(a.affinity)+"%",1)]),s("div",ot,[s("div",{class:w(["progress-bar",t.getAffinityClass(a.affinity)]),style:K({width:a.affinity+"%"})},null,6)])]),e[10]||(e[10]=n(" Medicamentos sugeridos ",-1)),s("div",lt,[e[6]||(e[6]=s("strong",{class:"text-success"},"Medicamentos sugeridos:",-1)),s("div",rt,[(i(!0),o(A,null,C(a.medications,b=>(i(),o("span",{key:b,class:"badge bg-success me-1"},u(b),1))),128))])]),e[11]||(e[11]=n(" Reglas activadas ",-1)),s("div",dt,[s("button",{class:"btn btn-sm btn-outline-info",onClick:b=>t.toggleRules(g)},[e[7]||(e[7]=s("i",{class:"fas fa-code me-1"},null,-1)),n(" "+u(t.showRules[g]?"Ocultar":"Ver")+" Reglas Prolog ",1)],8,ct),t.showRules[g]?(i(),o("div",mt,[s("div",ut,[e[8]||(e[8]=s("small",{class:"text-muted"},"Reglas activadas:",-1)),s("ul",gt,[(i(!0),o(A,null,C(a.activatedRules,b=>(i(),o("li",{key:b,class:"rule-item"},[s("code",null,u(b),1)]))),128))])])])):D("",!0)])]),s("div",vt,[s("div",yt,[s("div",{class:w(["urgency-circle",t.getUrgencyCircleClass(a.urgencyLevel)])},[s("i",{class:w(t.getUrgencyIcon(a.urgencyLevel))},null,2)],2),s("div",ft,[s("strong",null,u(a.urgency),1)])])])])])])]))),128))]),e[18]||(e[18]=n(" Advertencias importantes ",-1)),e[19]||(e[19]=s("div",{class:"alert alert-warning mb-4"},[s("h6",{class:"alert-heading"},[s("i",{class:"fas fa-exclamation-triangle me-2"}),n(" Advertencias Importantes ")]),s("ul",{class:"mb-0"},[s("li",null,"Este análisis es una herramienta de apoyo diagnóstico preliminar."),s("li",null,"NO sustituye la consulta médica profesional."),s("li",null,"Los medicamentos sugeridos han sido filtrados considerando sus alergias reportadas."),s("li",null,"Consulte siempre con un profesional de la salud antes de tomar cualquier medicamento.")])],-1)),e[20]||(e[20]=n(" Acciones ",-1)),s("div",pt,[s("button",{class:"btn btn-outline-primary",onClick:e[0]||(e[0]=(...a)=>t.newAnalysis&&t.newAnalysis(...a))},[...e[13]||(e[13]=[s("i",{class:"fas fa-plus me-2"},null,-1),n(" Nuevo Análisis ",-1)])]),s("div",null,[s("button",{class:"btn btn-success me-2",onClick:e[1]||(e[1]=(...a)=>t.downloadReport&&t.downloadReport(...a))},[...e[14]||(e[14]=[s("i",{class:"fas fa-download me-2"},null,-1),n(" Descargar Reporte PDF ",-1)])]),s("button",{class:"btn btn-info",onClick:e[2]||(e[2]=(...a)=>t.shareResults&&t.shareResults(...a))},[...e[15]||(e[15]=[s("i",{class:"fas fa-share me-2"},null,-1),n(" Compartir Resultados ",-1)])])])])])])}const ht=L(je,[["render",bt],["__scopeId","data-v-c0242413"]]),_t={name:"SessionHistory",props:{history:{type:Array,default:()=>[]}},emits:["load-analysis"],setup(y,{emit:e}){return{formatDate:v=>new Intl.DateTimeFormat("es-ES",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(v),loadAnalysis:v=>{e("load-analysis",v)},clearHistory:()=>{confirm("¿Está seguro de que desea limpiar el historial de esta sesión?")&&console.log("Limpiando historial...")}}}},wt={class:"card"},Dt={class:"card-body"},At={key:0,class:"text-center text-muted"},Ct={key:1},kt={class:"card border-left-primary"},xt={class:"card-body p-3"},St={class:"d-flex justify-content-between align-items-start mb-2"},$t={class:"mb-1"},Rt={class:"text-muted"},Pt={class:"mb-2"},zt={class:"symptoms-preview"},It={key:0,class:"text-muted"},Ht={class:"mb-2"},Lt={class:"results-preview"},Nt={class:"result-name"},Mt={class:"result-affinity"},Bt={key:0,class:"text-muted small"},Ut=["onClick"],Et={class:"text-center mt-3"};function jt(y,e,l,t,f,v){return i(),o("div",wt,[e[6]||(e[6]=s("div",{class:"card-header bg-secondary text-white"},[s("h6",{class:"mb-0"},[s("i",{class:"fas fa-history me-2"}),n(" Historial de Sesión ")])],-1)),s("div",Dt,[l.history.length===0?(i(),o("div",At,[...e[1]||(e[1]=[s("i",{class:"fas fa-inbox fa-2x mb-2"},null,-1),s("p",{class:"mb-0"},"No hay análisis previos en esta sesión",-1)])])):(i(),o("div",Ct,[(i(!0),o(A,null,C(l.history,a=>(i(),o("div",{key:a.id,class:"history-item mb-3"},[s("div",kt,[s("div",xt,[s("div",St,[s("h6",$t,"Análisis #"+u(a.id),1),s("small",Rt,u(t.formatDate(a.timestamp)),1)]),s("div",Pt,[e[2]||(e[2]=s("small",{class:"text-muted"},"Síntomas reportados:",-1)),s("div",zt,[(i(!0),o(A,null,C(a.symptoms.slice(0,3),g=>(i(),o("span",{key:g.id,class:"badge bg-light text-dark me-1"},u(g.name),1))),128)),a.symptoms.length>3?(i(),o("span",It," +"+u(a.symptoms.length-3)+" más ",1)):D("",!0)])]),s("div",Ht,[e[3]||(e[3]=s("small",{class:"text-muted"},"Diagnósticos encontrados:",-1)),s("div",Lt,[(i(!0),o(A,null,C(a.results.slice(0,2),g=>(i(),o("div",{key:g.name,class:"result-item"},[s("span",Nt,u(g.name),1),s("span",Mt,u(g.affinity)+"%",1)]))),128)),a.results.length>2?(i(),o("div",Bt," +"+u(a.results.length-2)+" diagnósticos más ",1)):D("",!0)])]),s("button",{class:"btn btn-sm btn-outline-primary w-100",onClick:g=>t.loadAnalysis(a)},[...e[4]||(e[4]=[s("i",{class:"fas fa-eye me-1"},null,-1),n(" Ver Análisis Completo ",-1)])],8,Ut)])])]))),128)),s("div",Et,[s("button",{class:"btn btn-sm btn-outline-danger",onClick:e[0]||(e[0]=(...a)=>t.clearHistory&&t.clearHistory(...a))},[...e[5]||(e[5]=[s("i",{class:"fas fa-trash me-1"},null,-1),n(" Limpiar Historial ",-1)])])])]))])])}const Tt=L(_t,[["render",jt],["__scopeId","data-v-fe95478e"]]),Vt={name:"PatientView",components:{SymptomSelector:zs,MedicalHistory:le,DiagnosisAnalysis:Ee,DiagnosisResults:ht,SessionHistory:Tt},setup(){const y=k(1),e=k(!1),l=k(!1),t=k(null),f=k([]),v=rs(),a=G({symptoms:[],allergies:[],chronicDiseases:[]}),g=p=>{a.symptoms=p},b=p=>{a.allergies=p},x=p=>{a.chronicDiseases=p},S=()=>{y.value<4&&y.value++},z=()=>{y.value>1&&y.value--},h=async()=>{e.value=!0;try{const p=M=>(M||"").toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/\s+/g,"_").replace(/[^a-z0-9_]/g,""),H={symptoms:a.symptoms.map(M=>({id:M.id,severity:M.severity})),allergies:a.allergies.map(p),chronics:a.chronicDiseases.map(p),top:5},N=await cs.post("/diagnose",H);console.log(N);const I=E(N);console.log(I),t.value=I,f.value.unshift({id:I.analysisId,timestamp:I.timestamp,symptoms:[...a.symptoms],results:I.diseases}),y.value=4}catch(p){const H=p?.message||"No se pudo realizar el análisis";alert(H)}finally{e.value=!1}};function E(p){const H=Array.isArray(p)?p:p?.diseases||p?.diagnoses||p?.results||[],N=(m,P)=>{const R=(m||"").toString().toLowerCase();if(R==="alta"||R==="high")return"high";if(R==="media"||R==="medium")return"medium";if(R==="baja"||R==="low")return"low";if(typeof P=="number"){if(P>=80)return"high";if(P>=50)return"medium"}return"low"},I=(m,P)=>{if(m)return{alta:"Alta",media:"Media",baja:"Baja",high:"Alta",medium:"Media",low:"Baja"}[(m+"").toLowerCase()]||m;const R=N(null,P);return{high:"Alta",medium:"Media",low:"Baja"}[R]};return{diseases:(Array.isArray(H)?H:[]).map(m=>{const P=Math.round(m.affinity??m.score??m.match??0),R=N(m.urgency||m.urgency_level||m.urgencyLevel,P),O=I(m.urgency||m.urgency_label||m.urgencyLevel,P),J=m.medications||m.drugs||(m.medication_name?[m.medication_name]:m.medication?[m.medication]:[]),Q=(m.activatedRules||m.rules||[]).map(_=>{if(typeof _=="string")return _;if(_&&typeof _=="object"){const W=_.symptom_id||_.symptom||_.s||"?",X=_.symptom_name?`(${_.symptom_name})`:"",Y=_.severity||_.sev,Z=_.weight??_.wc,ss=_.severity_weight??_.ws,es=_.contribution;return`regla(${m.disease_id||m.disease||m.name||"?"}, ${W}${X}, sev=${Y}, wc=${Z}, ws=${ss}, contrib=${es})`}return String(_)});return{id:m.disease_id||m.id||m.disease,name:m.disease_name||m.name||m.title||"Diagnóstico",category:m.category||m.type,description:m.description,affinity:P,urgency:O,urgencyLevel:R,medications:J,activatedRules:Q}}),timestamp:new Date,analysisId:Date.now()}}return{currentStep:y,patientData:a,isAnalyzing:e,showHistory:l,analysisResults:t,sessionHistory:f,updateSymptoms:g,updateAllergies:b,updateChronicDiseases:x,nextStep:S,previousStep:z,performAnalysis:h,resetAnalysis:()=>{y.value=1,t.value=null,a.symptoms=[],a.allergies=[],a.chronicDiseases=[]},loadPreviousAnalysis:p=>{a.symptoms=[...p.symptoms],t.value={diseases:p.results,timestamp:p.timestamp,analysisId:p.id},y.value=4,l.value=!1},downloadReport:()=>{console.log("Descargando reporte PDF...")},Onlogout:()=>{console.log("Si entra aqui"),ls(),v.push({name:"home"}),window.location.href="/",console.log("Cerrando sesión...")}}}},Ot={class:"container-fluid"},qt={class:"row"},Ft={class:"col-12"},Kt={class:"navbar navbar-expand-lg navbar-light bg-light border-bottom"},Gt={class:"container-fluid"},Jt={class:"d-flex"},Qt={class:"row mt-4"},Wt={class:"col-lg-8"},Xt={class:"card mb-4"},Yt={class:"card-body"},Zt={class:"d-flex justify-content-between align-items-center"},sa={class:"col-lg-4"},ea={key:1,class:"card"};function ta(y,e,l,t,f,v){const a=U("SymptomSelector"),g=U("MedicalHistory"),b=U("DiagnosisAnalysis"),x=U("DiagnosisResults"),S=U("SessionHistory");return i(),o("div",Ot,[s("div",qt,[s("div",Ft,[s("nav",Kt,[s("div",Gt,[e[4]||(e[4]=s("span",{class:"navbar-brand mb-0 h1"},[s("i",{class:"fas fa-user-md text-primary me-2"}),n(" Medi Logic - Módulo Paciente ")],-1)),s("div",Jt,[s("button",{class:"btn btn-outline-secondary me-2",onClick:e[0]||(e[0]=z=>t.showHistory=!t.showHistory)},[...e[2]||(e[2]=[s("i",{class:"fas fa-history me-1"},null,-1),n(" Historial ",-1)])]),s("button",{class:"btn btn-outline-danger",onClick:e[1]||(e[1]=(...z)=>t.Onlogout&&t.Onlogout(...z))},[...e[3]||(e[3]=[s("i",{class:"fas fa-sign-out-alt me-1"},null,-1),n(" Salir ",-1)])])])])])])]),s("div",Qt,[s("div",Wt,[s("div",Xt,[s("div",Yt,[s("div",Zt,[s("div",{class:w(["step",{active:t.currentStep>=1,completed:t.currentStep>1}])},[...e[5]||(e[5]=[s("div",{class:"step-number"},"1",-1),s("div",{class:"step-label"},"Síntomas",-1)])],2),s("div",{class:w(["step",{active:t.currentStep>=2,completed:t.currentStep>2}])},[...e[6]||(e[6]=[s("div",{class:"step-number"},"2",-1),s("div",{class:"step-label"},"Historial Médico",-1)])],2),s("div",{class:w(["step",{active:t.currentStep>=3,completed:t.currentStep>3}])},[...e[7]||(e[7]=[s("div",{class:"step-number"},"3",-1),s("div",{class:"step-label"},"Análisis",-1)])],2),s("div",{class:w(["step",{active:t.currentStep>=4}])},[...e[8]||(e[8]=[s("div",{class:"step-number"},"4",-1),s("div",{class:"step-label"},"Resultados",-1)])],2)])])]),t.currentStep===1?(i(),B(a,{key:0,selectedSymptoms:t.patientData.symptoms,"onUpdate:symptoms":t.updateSymptoms,onNext:t.nextStep},null,8,["selectedSymptoms","onUpdate:symptoms","onNext"])):D("",!0),t.currentStep===2?(i(),B(g,{key:1,allergies:t.patientData.allergies,chronicDiseases:t.patientData.chronicDiseases,"onUpdate:allergies":t.updateAllergies,"onUpdate:chronicDiseases":t.updateChronicDiseases,onNext:t.nextStep,onPrevious:t.previousStep},null,8,["allergies","chronicDiseases","onUpdate:allergies","onUpdate:chronicDiseases","onNext","onPrevious"])):D("",!0),t.currentStep===3?(i(),B(b,{key:2,patientData:t.patientData,isAnalyzing:t.isAnalyzing,onAnalyze:t.performAnalysis,onPrevious:t.previousStep},null,8,["patientData","isAnalyzing","onAnalyze","onPrevious"])):D("",!0),t.currentStep===4?(i(),B(x,{key:3,results:t.analysisResults,patientData:t.patientData,onNewAnalysis:t.resetAnalysis,onDownloadReport:t.downloadReport},null,8,["results","patientData","onNewAnalysis","onDownloadReport"])):D("",!0)]),s("div",sa,[t.showHistory?(i(),B(S,{key:0,history:t.sessionHistory,onLoadAnalysis:t.loadPreviousAnalysis},null,8,["history","onLoadAnalysis"])):D("",!0),t.showHistory?D("",!0):(i(),o("div",ea,[...e[9]||(e[9]=[s("div",{class:"card-header bg-info text-white"},[s("h6",{class:"mb-0"},[s("i",{class:"fas fa-info-circle me-2"}),n(" Información Importante ")])],-1),s("div",{class:"card-body"},[s("div",{class:"alert alert-warning",role:"alert"},[s("small",null,[s("strong",null,"Aviso:"),n(" Este sistema es una herramienta de apoyo diagnóstico preliminar y NO sustituye la consulta médica profesional. ")])]),s("ul",{class:"list-unstyled small"},[s("li",{class:"mb-2"},[s("i",{class:"fas fa-check text-success me-2"}),n(" Selecciona todos los síntomas que presentas ")]),s("li",{class:"mb-2"},[s("i",{class:"fas fa-check text-success me-2"}),n(" Indica el nivel de severidad de cada síntoma ")]),s("li",{class:"mb-2"},[s("i",{class:"fas fa-check text-success me-2"}),n(" Proporciona información completa sobre alergias ")]),s("li",{class:"mb-2"},[s("i",{class:"fas fa-check text-success me-2"}),n(" Menciona enfermedades crónicas existentes ")])])],-1)])]))])])])}const oa=L(Vt,[["render",ta],["__scopeId","data-v-fa4555b4"]]);export{oa as default};
