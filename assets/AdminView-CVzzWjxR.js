import{_ as K,a as f,b as e,h as w,x as E,o as m,d as L,r as c,t as v,F,s as H,z as G,f as A,w as R,i as M,v as x,q as z,e as W,c as P,p as I,E as q,j as U,C as O,G as Q,l as V,D as j,m as J,u as X}from"./index-e6o2DU1H.js";import{a as k}from"./adminServices-UsykoH-M.js";const Y={name:"AdminSidebar",props:{activeSection:{type:String,default:"dashboard"}},emits:["section-change"]},Z={class:"bg-primary text-white",style:{width:"250px","min-height":"100vh"}},ee={class:"nav flex-column p-3"};function te(_,d,u,y,t,r){return m(),f("div",Z,[d[12]||(d[12]=e("div",{class:"p-3 border-bottom"},[e("h5",{class:"mb-0"},[e("i",{class:"fas fa-user-md me-2"}),w(" Panel Admin ")])],-1)),e("nav",ee,[e("a",{href:"#",class:E(["nav-link text-white mb-2 rounded",{"bg-secondary":u.activeSection==="dashboard"}]),onClick:d[0]||(d[0]=h=>_.$emit("section-change","dashboard"))},[...d[6]||(d[6]=[e("i",{class:"fas fa-tachometer-alt me-2"},null,-1),w(" Dashboard ",-1)])],2),e("a",{href:"#",class:E(["nav-link text-white mb-2 rounded",{"bg-secondary":u.activeSection==="symptoms"}]),onClick:d[1]||(d[1]=h=>_.$emit("section-change","symptoms"))},[...d[7]||(d[7]=[e("i",{class:"fas fa-stethoscope me-2"},null,-1),w(" Síntomas ",-1)])],2),e("a",{href:"#",class:E(["nav-link text-white mb-2 rounded",{"bg-secondary":u.activeSection==="diseases"}]),onClick:d[2]||(d[2]=h=>_.$emit("section-change","diseases"))},[...d[8]||(d[8]=[e("i",{class:"fas fa-virus me-2"},null,-1),w(" Enfermedades ",-1)])],2),e("a",{href:"#",class:E(["nav-link text-white mb-2 rounded",{"bg-secondary":u.activeSection==="medicines"}]),onClick:d[3]||(d[3]=h=>_.$emit("section-change","medicines"))},[...d[9]||(d[9]=[e("i",{class:"fas fa-pills me-2"},null,-1),w(" Medicamentos ",-1)])],2),e("a",{href:"#",class:E(["nav-link text-white mb-2 rounded",{"bg-secondary":u.activeSection==="contraindications"}]),onClick:d[4]||(d[4]=h=>_.$emit("section-change","contraindications"))},[...d[10]||(d[10]=[e("i",{class:"fas fa-stethoscope me-2"},null,-1),w(" Constraindicaciones ",-1)])],2),e("a",{href:"#",class:E(["nav-link text-white mb-2 rounded",{"bg-secondary":u.activeSection==="files"}]),onClick:d[5]||(d[5]=h=>_.$emit("section-change","files"))},[...d[11]||(d[11]=[e("i",{class:"fas fa-file-code me-2"},null,-1),w(" Archivos .pl ",-1)])],2)])])}const se=K(Y,[["render",te]]),oe={class:"bg-white border-bottom p-3"},ae=L({__name:"AdminHeader",emits:["logout"],setup(_,{emit:d}){const u=d;function y(){u("logout")}return(t,r)=>(m(),f("header",oe,[e("div",{class:"d-flex justify-content-between align-items-center"},[r[2]||(r[2]=e("h1",{class:"h4 mb-0 text-primary"},[e("i",{class:"bi bi-heart-pulse me-2"}),w(" Medi Logic - Panel Administrativo ")],-1)),e("div",{class:"d-flex align-items-center"},[r[1]||(r[1]=e("span",{class:"me-3 text-muted"},"Dr. Admin",-1)),e("button",{class:"btn btn-outline-danger btn-sm",onClick:y},[...r[0]||(r[0]=[e("i",{class:"bi bi-box-arrow-right me-1"},null,-1),w(" Cerrar Sesión ",-1)])])])])]))}}),ne={class:"row mb-4"},le={class:"col-md-3 mb-3"},ie={class:"card bg-primary text-white"},de={class:"card-body"},re={class:"d-flex justify-content-between"},ce={class:"mb-0"},ue={class:"col-md-3 mb-3"},me={class:"card bg-success text-white"},ve={class:"card-body"},pe={class:"d-flex justify-content-between"},be={class:"mb-0"},ge={class:"col-md-3 mb-3"},fe={class:"card bg-info text-white"},ye={class:"card-body"},he={class:"d-flex justify-content-between"},_e={class:"mb-0"},$e={class:"col-md-3 mb-3"},we={class:"card bg-warning text-white"},Me={class:"card-body"},Ce={class:"d-flex justify-content-between"},Se={class:"mb-0"},xe={class:"card"},ke={class:"card-body"},Ee={class:"list-group list-group-flush"},De={class:"d-flex justify-content-between"},Ne={class:"mb-0 text-muted small"},Ae={class:"text-muted"},Be={__name:"DashboardStats",setup(_){const d=c({totalDiseases:156,totalMedicines:89,totalSymptoms:234,todayConsults:12}),u=c([{id:1,action:"Nueva enfermedad agregada",description:"Hipertensión arterial sistémica",time:"Hace 2 horas"},{id:2,action:"Medicamento actualizado",description:"Paracetamol - Dosis modificada",time:"Hace 4 horas"},{id:3,action:"Síntoma asociado",description:"Dolor de cabeza vinculado a migraña",time:"Hace 6 horas"}]);return(y,t)=>(m(),f("div",null,[t[9]||(t[9]=e("h2",{class:"h4 mb-4"},"Dashboard Principal",-1)),t[10]||(t[10]=w(" Estadísticas ",-1)),e("div",ne,[e("div",le,[e("div",ie,[e("div",de,[e("div",re,[e("div",null,[t[0]||(t[0]=e("h6",{class:"card-title"},"Total Enfermedades",-1)),e("h3",ce,v(d.value.totalDiseases),1)]),t[1]||(t[1]=e("i",{class:"bi bi-virus fs-1 opacity-50"},null,-1))])])])]),e("div",ue,[e("div",me,[e("div",ve,[e("div",pe,[e("div",null,[t[2]||(t[2]=e("h6",{class:"card-title"},"Medicamentos",-1)),e("h3",be,v(d.value.totalMedicines),1)]),t[3]||(t[3]=e("i",{class:"bi bi-capsule fs-1 opacity-50"},null,-1))])])])]),e("div",ge,[e("div",fe,[e("div",ye,[e("div",he,[e("div",null,[t[4]||(t[4]=e("h6",{class:"card-title"},"Síntomas",-1)),e("h3",_e,v(d.value.totalSymptoms),1)]),t[5]||(t[5]=e("i",{class:"bi bi-clipboard-pulse fs-1 opacity-50"},null,-1))])])])]),e("div",$e,[e("div",we,[e("div",Me,[e("div",Ce,[e("div",null,[t[6]||(t[6]=e("h6",{class:"card-title"},"Consultas Hoy",-1)),e("h3",Se,v(d.value.todayConsults),1)]),t[7]||(t[7]=e("i",{class:"bi bi-people fs-1 opacity-50"},null,-1))])])])])]),t[11]||(t[11]=w(" Actividad Reciente ",-1)),e("div",xe,[t[8]||(t[8]=e("div",{class:"card-header"},[e("h5",{class:"mb-0"},"Actividad Reciente")],-1)),e("div",ke,[e("div",Ee,[(m(!0),f(F,null,H(u.value,r=>(m(),f("div",{key:r.id,class:"list-group-item border-0 px-0"},[e("div",De,[e("div",null,[e("strong",null,v(r.action),1),e("p",Ne,v(r.description),1)]),e("small",Ae,v(r.time),1)])]))),128))])])])]))}},Le={key:0,id:"diseaseModal",class:"modal d-block",tabindex:"-1",style:{"background-color":"rgba(0,0,0,0.5)"}},Te={class:"modal-dialog modal-lg"},Ve={class:"modal-content"},Ie={class:"modal-header"},je={class:"modal-title"},Ue={class:"modal-body"},ze={class:"mb-3"},qe={class:"row mb-3"},Fe={class:"col-md-6"},He={class:"col-md-6"},Oe={class:"mb-3"},Ge={class:"mb-3"},Re={class:"modal-footer"},Pe=L({__name:"DiseaseModal",props:{show:{type:Boolean},disease:{}},emits:["close","save"],setup(_,{emit:d}){const u=_,y=d,t=c({name:"",category:"",description:"",symptomsText:"",medicinesText:""});G(()=>u.disease,n=>{n?t.value={name:n.name||"",category:n.category||"",description:n.description||"",symptomsText:Object.entries(n.symptom_weights||{}).map(([s,i])=>`${s}=${i}`).join(", "),medicinesText:(n.medications||[]).join(", ")}:t.value={name:"",category:"",description:"",symptomsText:"",medicinesText:""}},{immediate:!0});function r(n){const s={};return n.split(",").map(i=>i.trim()).filter(Boolean).forEach(i=>{const[$,S]=i.split("=").map(D=>(D||"").trim());if(!$)return;const C=S?Number(S):.6;s[$]=isFinite(C)?Math.max(0,Math.min(1,C)):.6}),s}function h(n){return n.split(",").map(s=>s.trim()).filter(Boolean)}function p(){const n={name:t.value.name.trim(),category:t.value.category.trim(),description:t.value.description.trim(),symptom_weights:r(t.value.symptomsText),medications:h(t.value.medicinesText)};!n.name||!n.category||y("save",n)}return(n,s)=>n.show?(m(),f("div",Le,[e("div",Te,[e("div",Ve,[e("div",Ie,[e("h5",je,v(n.disease?"Editar Enfermedad":"Nueva Enfermedad"),1),e("button",{onClick:s[0]||(s[0]=i=>n.$emit("close")),type:"button",class:"btn-close"})]),e("div",Ue,[e("form",{onSubmit:R(p,["prevent"])},[e("div",ze,[s[7]||(s[7]=e("label",{class:"form-label"},"Nombre de la Enfermedad",-1)),M(e("input",{"onUpdate:modelValue":s[1]||(s[1]=i=>t.value.name=i),type:"text",class:"form-control",required:""},null,512),[[x,t.value.name]])]),e("div",qe,[e("div",Fe,[s[9]||(s[9]=e("label",{class:"form-label"},"Sistema del Cuerpo",-1)),M(e("select",{"onUpdate:modelValue":s[2]||(s[2]=i=>t.value.category=i),class:"form-select",required:""},[...s[8]||(s[8]=[W('<option value="">Seleccionar sistema</option><option value="cardiovascular">Cardiovascular</option><option value="respiratorio">Respiratorio</option><option value="digestivo">Digestivo</option><option value="neurológico">Neurológico</option><option value="endocrino">Endocrino</option><option value="general">General</option>',7)])],512),[[z,t.value.category]])]),e("div",He,[s[10]||(s[10]=e("label",{class:"form-label"},"Descripción",-1)),M(e("input",{"onUpdate:modelValue":s[3]||(s[3]=i=>t.value.description=i),type:"text",class:"form-control",placeholder:"Breve descripción"},null,512),[[x,t.value.description]])])]),e("div",Oe,[s[11]||(s[11]=e("label",{class:"form-label"},"Síntomas con peso",-1)),M(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=i=>t.value.symptomsText=i),class:"form-control",rows:"3",placeholder:"Formato: fiebre=0.8, tos=0.5 (si omites el peso, se toma 0.6)"},null,512),[[x,t.value.symptomsText]]),s[12]||(s[12]=e("small",{class:"text-muted"},"El backend requiere pesos por síntoma (0–1). Se usarán para el cálculo de afinidad.",-1))]),e("div",Ge,[s[13]||(s[13]=e("label",{class:"form-label"},"Medicamentos Recomendados",-1)),M(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=i=>t.value.medicinesText=i),class:"form-control",rows:"3",placeholder:"Ej: paracetamol, oseltamivir"},null,512),[[x,t.value.medicinesText]])])],32)]),e("div",Re,[e("button",{onClick:s[6]||(s[6]=i=>n.$emit("close")),type:"button",class:"btn btn-secondary"},"Cancelar"),e("button",{onClick:p,type:"button",class:"btn btn-primary"},v(n.disease?"Actualizar":"Crear")+" Enfermedad ",1)])])])])):A("",!0)}}),We={class:"d-flex justify-content-between align-items-center mb-4"},Ke={class:"card mb-4"},Qe={class:"card-body"},Je={class:"row"},Xe={class:"col-md-6"},Ye={class:"col-md-6"},Ze={class:"card"},et={class:"card-body"},tt={class:"table-responsive"},st={class:"table table-hover"},ot={key:0},at={key:1},nt=["onClick"],lt=["onClick"],it=L({__name:"DiseasesManager",setup(_){const d=c(""),u=c(""),y=c(!1),t=c(null),r=c([]),h=c(!1),p=c(!1),n=c("success"),s=c("");function i(a,o){n.value=a,s.value=o,p.value=!0,setTimeout(()=>p.value=!1,3e3)}const $=P(()=>r.value.filter(a=>{const o=a.name.toLowerCase().includes(d.value.toLowerCase())||(a.description||"").toLowerCase().includes(d.value.toLowerCase()),g=!u.value||(a.category||"")===u.value;return o&&g}));function S(a){return{cardiovascular:"bg-danger",respiratorio:"bg-info",digestivo:"bg-warning",neurológico:"bg-success",endocrino:"bg-secondary",general:"bg-primary"}[a||""]||"bg-secondary"}async function C(){h.value=!0;try{r.value=await k.listDiseases()}catch(a){i("danger",a?.message||"No se pudo cargar enfermedades"),console.error(a)}finally{h.value=!1}}function D(a){t.value=a?{...a}:null,y.value=!0}function N(){y.value=!1,t.value=null}function B(a){return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")}async function b(a){try{const g={id:t.value?.id||B(a.name||"enfermedad"),name:a.name,category:a.category||void 0,description:a.description||void 0,symptom_weights:a.symptom_weights||{},medications:a.medications||[]};await k.createDisease(g),await C(),N(),i("success",t.value?"Enfermedad actualizada":"Enfermedad creada")}catch(o){i("danger",o?.message||"No se pudo guardar la enfermedad")}}async function l(a){if(confirm("¿Está seguro de eliminar esta enfermedad?"))try{await k.deleteDisease(a),await C(),i("success","Enfermedad eliminada")}catch(o){i("danger",o?.message||"No se pudo eliminar")}}return I(()=>{C(),document.querySelector("#diseaseModal")?.addEventListener("hidden.bs.modal",N)}),q(()=>{document.querySelector("#diseaseModal")?.removeEventListener("hidden.bs.modal",N)}),(a,o)=>(m(),f("div",null,[e("div",We,[o[4]||(o[4]=e("h2",{class:"h4 mb-0"},"Gestión de Enfermedades",-1)),e("button",{onClick:o[0]||(o[0]=g=>D()),class:"btn btn-primary"},[...o[3]||(o[3]=[e("i",{class:"bi bi-plus-circle me-2"},null,-1),w(" Nueva Enfermedad ",-1)])])]),p.value?(m(),f("div",{key:0,class:E(["alert",{"alert-success":n.value==="success","alert-danger":n.value==="danger","alert-warning":n.value==="warning"}]),role:"alert"},v(s.value),3)):A("",!0),e("div",Ke,[e("div",Qe,[e("div",Je,[e("div",Xe,[M(e("input",{"onUpdate:modelValue":o[1]||(o[1]=g=>d.value=g),type:"text",class:"form-control",placeholder:"Buscar enfermedad..."},null,512),[[x,d.value]])]),e("div",Ye,[M(e("select",{"onUpdate:modelValue":o[2]||(o[2]=g=>u.value=g),class:"form-select"},[...o[5]||(o[5]=[W('<option value="">Todos los sistemas</option><option value="respiratorio">Respiratorio</option><option value="digestivo">Digestivo</option><option value="cardiovascular">Cardiovascular</option><option value="neurológico">Neurológico</option><option value="endocrino">Endocrino</option><option value="general">General</option>',7)])],512),[[z,u.value]])])])])]),e("div",Ze,[e("div",et,[e("div",tt,[e("table",st,[o[10]||(o[10]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Nombre"),e("th",null,"Sistema"),e("th",null,"Síntomas"),e("th",null,"Medicamentos"),e("th",{style:{width:"160px"}},"Acciones")])],-1)),e("tbody",null,[h.value?(m(),f("tr",ot,[...o[6]||(o[6]=[e("td",{colspan:"5"},"Cargando...",-1)])])):$.value.length===0?(m(),f("tr",at,[...o[7]||(o[7]=[e("td",{colspan:"5"},"No hay enfermedades",-1)])])):(m(!0),f(F,{key:2},H($.value,g=>(m(),f("tr",{key:g.id},[e("td",null,v(g.name),1),e("td",null,[e("span",{class:E(["badge",S(g.category)])},v(g.category||"—"),3)]),e("td",null,v(Object.keys(g.symptom_weights||{}).length),1),e("td",null,v(g.medications?.length||0),1),e("td",null,[e("button",{onClick:T=>D(g),class:"btn btn-sm btn-outline-primary me-2"},[...o[8]||(o[8]=[e("i",{class:"bi bi-pencil"},null,-1)])],8,nt),e("button",{onClick:T=>l(g.id),class:"btn btn-sm btn-outline-danger"},[...o[9]||(o[9]=[e("i",{class:"bi bi-trash"},null,-1)])],8,lt)])]))),128))])])])])]),U(Pe,{show:y.value,disease:t.value,onClose:N,onSave:b},null,8,["show","disease"])]))}}),dt={class:"modal fade",id:"medicineModal",tabindex:"-1","aria-labelledby":"medicineModalLabel","aria-hidden":"true"},rt={class:"modal-dialog"},ct={class:"modal-header"},ut={class:"modal-title",id:"medicineModalLabel"},mt={class:"modal-body"},vt={class:"mb-3"},pt=["readonly"],bt={class:"mb-3"},gt={key:0,class:"text-danger"},ft={class:"modal-footer"},yt={type:"submit",class:"btn btn-primary"},ht=L({__name:"MedicineModal",props:{medicine:{},isEditing:{type:Boolean}},emits:["save"],setup(_,{emit:d}){const u=_,y=d,t=O({id:"",name:""}),r=c();G(()=>u.medicine,n=>{n?Object.assign(t,n):Object.assign(t,{id:"",name:""})},{immediate:!0});function h(){if(r.value=void 0,!/^[a-z0-9_]+$/.test(t.id)){r.value="ID inválido: usa minúsculas, números y _";return}if(!t.name.trim()){r.value="Nombre requerido";return}y("save",{...t})}function p(){Object.assign(t,{id:"",name:""}),r.value=void 0}return I(()=>{document.getElementById("medicineModal")?.addEventListener("hidden.bs.modal",p)}),q(()=>{document.getElementById("medicineModal")?.removeEventListener("hidden.bs.modal",p)}),(n,s)=>(m(),f("div",dt,[e("div",rt,[e("form",{class:"modal-content",onSubmit:R(h,["prevent"])},[e("div",ct,[e("h5",ut,v(n.isEditing?"Editar Medicamento":"Nuevo Medicamento"),1),s[2]||(s[2]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cerrar"},null,-1))]),e("div",mt,[e("div",vt,[s[3]||(s[3]=e("label",{class:"form-label"},[w("ID "),e("small",{class:"text-muted"},"(minúsculas, números y _)")],-1)),M(e("input",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=i=>t.id=i),readonly:n.isEditing,required:"",placeholder:"paracetamol"},null,8,pt),[[x,t.id]])]),e("div",bt,[s[4]||(s[4]=e("label",{class:"form-label"},"Nombre",-1)),M(e("input",{class:"form-control","onUpdate:modelValue":s[1]||(s[1]=i=>t.name=i),required:"",placeholder:"Paracetamol"},null,512),[[x,t.name]])]),r.value?(m(),f("small",gt,v(r.value),1)):A("",!0)]),e("div",ft,[s[5]||(s[5]=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Cancelar",-1)),e("button",yt,v(n.isEditing?"Guardar cambios":"Crear"),1)])],32)])]))}}),_t={class:"row mb-4"},$t={class:"col-md-4"},wt={class:"card"},Mt={class:"card-body"},Ct={class:"table-responsive"},St={class:"table table-hover"},xt={key:0},kt={key:1},Et=["onClick"],Dt=L({__name:"MedicinesManager",setup(_){const d=c([]),u=c(""),y=c(null),t=c(!1),r=c(!1),h=c(!1),p=c("success"),n=c("");function s(b,l){p.value=b,n.value=l,h.value=!0,setTimeout(()=>h.value=!1,3e3)}const i=P(()=>d.value.filter(b=>b.name.toLowerCase().includes(u.value.toLowerCase())));async function $(){r.value=!0;try{d.value=await k.listMedications()}catch(b){s("danger",b?.message||"No se pudo cargar medicamentos"),console.error(b)}finally{r.value=!1}}function S(){y.value=null,t.value=!1}function C(){const b=document.getElementById("medicineModal"),l=window.bootstrap?.Modal;b&&l&&(l.getInstance(b)||new l(b)).hide()}async function D(b){try{await k.createMedication(b),await $(),C(),s("success",t.value?"Medicamento actualizado":"Medicamento creado")}catch(l){s("danger",l?.message||"No se pudo guardar el medicamento")}}async function N(b){if(confirm("¿Está seguro de eliminar este medicamento?"))try{await k.deleteMedication(b),await $(),s("success","Medicamento eliminado")}catch(l){s("danger",l?.message||"No se pudo eliminar")}}function B(){y.value=null,t.value=!1}return I(()=>{$(),document.getElementById("medicineModal")?.addEventListener("hidden.bs.modal",B)}),q(()=>{document.getElementById("medicineModal")?.removeEventListener("hidden.bs.modal",B)}),(b,l)=>(m(),f("div",null,[e("div",{class:"d-flex justify-content-between align-items-center mb-4"},[l[2]||(l[2]=e("h2",null,"Gestión de Medicamentos",-1)),e("button",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#medicineModal",onClick:S},[...l[1]||(l[1]=[e("i",{class:"fas fa-plus me-2"},null,-1),w(" Nuevo Medicamento ",-1)])])]),h.value?(m(),f("div",{key:0,class:E(["alert",{"alert-success":p.value==="success","alert-danger":p.value==="danger","alert-warning":p.value==="warning"}]),role:"alert"},v(n.value),3)):A("",!0),e("div",_t,[e("div",$t,[M(e("input",{type:"text",class:"form-control",placeholder:"Buscar medicamento...","onUpdate:modelValue":l[0]||(l[0]=a=>u.value=a)},null,512),[[x,u.value]])])]),e("div",wt,[e("div",Mt,[e("div",Ct,[e("table",St,[l[6]||(l[6]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Nombre"),e("th",{style:{width:"160px"}},"Acciones")])],-1)),e("tbody",null,[r.value?(m(),f("tr",xt,[...l[3]||(l[3]=[e("td",{colspan:"2"},"Cargando...",-1)])])):i.value.length===0?(m(),f("tr",kt,[...l[4]||(l[4]=[e("td",{colspan:"2"},"No hay medicamentos",-1)])])):(m(!0),f(F,{key:2},H(i.value,a=>(m(),f("tr",{key:a.id},[e("td",null,v(a.name),1),e("td",null,[e("button",{class:"btn btn-sm btn-outline-danger",onClick:o=>N(a.id)},[...l[5]||(l[5]=[e("i",{class:"fas fa-trash"},null,-1),e("span",null,"Eliminar",-1)])],8,Et)])]))),128))])])])])]),U(ht,{medicine:y.value,"is-editing":t.value,onSave:D},null,8,["medicine","is-editing"])]))}}),Nt={class:"modal fade",id:"symptomModal",tabindex:"-1","aria-labelledby":"symptomModalLabel","aria-hidden":"true"},At={class:"modal-dialog"},Bt={class:"modal-header"},Lt={class:"modal-title",id:"symptomModalLabel"},Tt={class:"modal-body"},Vt={class:"mb-3"},It=["readonly"],jt={class:"mb-3"},Ut={class:"mb-3"},zt={class:"mb-3"},qt={key:0,class:"text-danger"},Ft={class:"modal-footer"},Ht={type:"submit",class:"btn btn-primary"},Ot=L({__name:"SymptomModal",props:{symptom:{},isEditing:{type:Boolean}},emits:["save"],setup(_,{emit:d}){const u=_,y=d,t=O({id:"",name:"",system:"",description:""}),r=O({});G(()=>u.symptom,n=>{n?Object.assign(t,n):Object.assign(t,{id:"",name:"",system:"",description:""})},{immediate:!0});function h(){if(r.msg=void 0,!/^[a-z0-9_]+$/.test(t.id)){r.msg="ID inválido (usa minúsculas, números y _)";return}if(!t.name.trim()){r.msg="Nombre requerido";return}y("save",{...t})}function p(){Object.assign(t,{id:"",name:"",system:"",description:""}),r.msg=void 0}return I(()=>{document.getElementById("symptomModal")?.addEventListener("hidden.bs.modal",p)}),q(()=>{document.getElementById("symptomModal")?.removeEventListener("hidden.bs.modal",p)}),(n,s)=>(m(),f("div",Nt,[e("div",At,[e("form",{class:"modal-content",onSubmit:R(h,["prevent"])},[e("div",Bt,[e("h5",Lt,v(n.isEditing?"Editar Síntoma":"Nuevo Síntoma"),1),s[4]||(s[4]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cerrar"},null,-1))]),e("div",Tt,[e("div",Vt,[s[5]||(s[5]=e("label",{class:"form-label"},"ID",-1)),M(e("input",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=i=>t.id=i),readonly:n.isEditing,required:"",placeholder:"fiebre"},null,8,It),[[x,t.id]])]),e("div",jt,[s[6]||(s[6]=e("label",{class:"form-label"},"Nombre",-1)),M(e("input",{class:"form-control","onUpdate:modelValue":s[1]||(s[1]=i=>t.name=i),required:"",placeholder:"Fiebre"},null,512),[[x,t.name]])]),e("div",Ut,[s[8]||(s[8]=e("label",{class:"form-label"},"Sistema",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=i=>t.system=i)},[...s[7]||(s[7]=[e("option",{value:""},"(sin sistema)",-1),e("option",null,"General",-1),e("option",null,"Respiratorio",-1),e("option",null,"Digestivo",-1),e("option",null,"Cardiovascular",-1),e("option",null,"Neurológico",-1),e("option",null,"Músculo-esquelético",-1),e("option",null,"Endocrino",-1),e("option",null,"Urinario",-1)])],512),[[z,t.system]])]),e("div",zt,[s[9]||(s[9]=e("label",{class:"form-label"},"Descripción",-1)),M(e("textarea",{class:"form-control",rows:"3","onUpdate:modelValue":s[3]||(s[3]=i=>t.description=i),placeholder:"Breve descripción..."},null,512),[[x,t.description]])]),r.msg?(m(),f("small",qt,v(r.msg),1)):A("",!0)]),e("div",Ft,[s[10]||(s[10]=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Cancelar",-1)),e("button",Ht,v(n.isEditing?"Guardar cambios":"Crear"),1)])],32)])]))}}),Gt={class:"row mb-4"},Rt={class:"col-md-4"},Pt={class:"col-md-3"},Wt={class:"card"},Kt={class:"card-body"},Qt={class:"table-responsive"},Jt={class:"table table-hover"},Xt={class:"badge bg-info"},Yt={class:"text-muted"},Zt=["onClick"],es=L({__name:"SymptomsManager",setup(_){const d=c([]),u=c(""),y=c(""),t=c(null),r=c(!1),h=c(!1),p=c(!1),n=c("success"),s=c("");function i(b,l){n.value=b,s.value=l,p.value=!0,setTimeout(()=>{p.value=!1},3e3)}const $=P(()=>d.value.filter(b=>{const l=b.name.toLowerCase().includes(u.value.toLowerCase())||(b.description||"").toLowerCase().includes(u.value.toLowerCase()),a=!y.value||(b.system||"")===y.value;return l&&a}));async function S(){h.value=!0;try{d.value=await k.listSymptoms(),console.log("Síntomas cargados:",d.value)}catch(b){i("danger",b?.message||"No se pudo cargar síntomas"),console.error("Error listSymptoms:",b)}finally{h.value=!1}}function C(){t.value=null,r.value=!1}function D(){const b=document.getElementById("symptomModal"),l=window.bootstrap?.Modal;b&&l&&(l.getInstance(b)||new l(b)).hide()}async function N(b){try{await k.createSymptom(b),await S(),D(),i("success",r.value?"Síntoma actualizado":"Síntoma creado")}catch(l){i("danger",l?.message||"No se pudo guardar el síntoma")}}async function B(b){if(confirm("¿Está seguro de eliminar este síntoma?"))try{await k.deleteSymptom(b),await S(),i("success","Síntoma eliminado")}catch(l){i("danger",l?.message||"No se pudo eliminar")}}return I(S),(b,l)=>(m(),f("div",null,[e("div",{class:"d-flex justify-content-between align-items-center mb-4"},[l[3]||(l[3]=e("h2",null,"Gestión de Síntomas",-1)),e("button",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#symptomModal",onClick:C},[...l[2]||(l[2]=[e("i",{class:"fas fa-plus me-2"},null,-1),w(" Nuevo Síntoma ",-1)])])]),p.value?(m(),f("div",{key:0,class:E(["alert",{"alert-success":n.value==="success","alert-danger":n.value==="danger","alert-warning":n.value==="warning"}]),role:"alert"},v(s.value),3)):A("",!0),l[7]||(l[7]=w(" Filtros ",-1)),e("div",Gt,[e("div",Rt,[M(e("input",{type:"text",class:"form-control",placeholder:"Buscar síntoma...","onUpdate:modelValue":l[0]||(l[0]=a=>u.value=a)},null,512),[[x,u.value]])]),e("div",Pt,[M(e("select",{class:"form-select","onUpdate:modelValue":l[1]||(l[1]=a=>y.value=a)},[...l[4]||(l[4]=[W('<option value="">Todos los sistemas</option><option value="Respiratorio">Respiratorio</option><option value="Digestivo">Digestivo</option><option value="Cardiovascular">Cardiovascular</option><option value="Neurológico">Neurológico</option>',5)])],512),[[z,y.value]])])]),l[8]||(l[8]=w(" Tabla de síntomas ",-1)),e("div",Wt,[e("div",Kt,[e("div",Qt,[e("table",Jt,[l[6]||(l[6]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Nombre"),e("th",null,"Sistema"),e("th",null,"Descripción"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(m(!0),f(F,null,H($.value,a=>(m(),f("tr",{key:a.id},[e("td",null,v(a.name),1),e("td",null,[e("span",Xt,v(a.system),1)]),e("td",null,[e("small",Yt,v(a.description?.slice(0,50))+"... ",1)]),e("td",null,[e("button",{class:"btn btn-sm btn-outline-danger",onClick:o=>B(a.id)},[...l[5]||(l[5]=[e("i",{class:"fas fa-trash"},null,-1),e("span",null,"Eliminar",-1)])],8,Zt)])]))),128))])])])])]),U(Ot,{symptom:t.value,"is-editing":r.value,onSave:N},null,8,["symptom","is-editing"])]))}}),ts={class:"d-flex justify-content-between align-items-center mb-4"},ss={class:"d-flex gap-2"},os=["disabled"],as=["disabled"],ns={class:"row mb-4"},ls={class:"col-md-3"},is={class:"card bg-info text-white"},ds={class:"card-body"},rs={class:"col-md-3"},cs={class:"card bg-warning text-white"},us={class:"card-body"},ms={class:"col-md-3"},vs={class:"card bg-success text-white"},ps={class:"card-body"},bs={class:"card"},gs={class:"card-body"},fs={class:"table-responsive"},ys={class:"table table-hover"},hs=["href"],_s={key:0},$s={class:"modal fade",id:"fileViewModal",tabindex:"-1"},ws={class:"modal-dialog modal-xl"},Ms={class:"modal-content"},Cs={class:"modal-header"},Ss={class:"modal-title"},xs={class:"modal-body"},ks={class:"bg-light p-3 rounded",style:{"max-height":"500px","overflow-y":"auto"}},Es=L({__name:"FilesManager",setup(_){const d="http://localhost:8080",u=c(!1),y=c(""),t=c(null),r=()=>t.value?.click(),h=c({name:"base.pl"}),p=c({rules:0,size:0,updatedAt:new Date}),n=c(!1),s=c("success"),i=c("");function $(a,o){s.value=a,i.value=o,n.value=!0,setTimeout(()=>n.value=!1,3e3)}function S(a){p.value.size=new Blob([a]).size,p.value.rules=(a.match(/:-/g)||[]).length,p.value.updatedAt=new Date}async function C(){u.value=!0;try{const a=await k.getBasePL();y.value=String(a||""),S(y.value)}catch(a){$("danger",a?.message||"No se pudo cargar base.pl")}finally{u.value=!1}}function D(){}async function N(){try{u.value=!0,await k.generateBasePL(),await C(),$("success","base.pl regenerado desde catálogos")}catch(a){$("danger",a?.message||"No se pudo regenerar base.pl")}finally{u.value=!1}}async function B(a){const o=a.target,g=o.files?.[0];if(o.value="",!!g){if(!g.name.endsWith(".pl")){$("warning","Seleccione un archivo .pl válido");return}try{u.value=!0,await k.uploadBasePL(g),await C(),$("success",`Archivo ${g.name} cargado y activado`)}catch(T){$("danger",T?.message||"No se pudo cargar el archivo")}finally{u.value=!1}}}function b(a){if(!a)return"0 Bytes";const o=1024,g=["Bytes","KB","MB","GB"],T=Math.floor(Math.log(a)/Math.log(o));return`${parseFloat((a/Math.pow(o,T)).toFixed(2))} ${g[T]}`}function l(a){try{return new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return""}}return I(C),(a,o)=>(m(),f("div",null,[e("div",ts,[o[2]||(o[2]=e("h2",null,"Gestión de Archivos .pl",-1)),e("div",ss,[e("button",{class:"btn btn-outline-success",onClick:N,disabled:u.value},[...o[0]||(o[0]=[e("i",{class:"fas fa-recycle me-2"},null,-1),w(" Regenerar desde catálogos ",-1)])],8,os),e("button",{class:"btn btn-primary",onClick:r,disabled:u.value},[...o[1]||(o[1]=[e("i",{class:"fas fa-upload me-2"},null,-1),w(" Cargar Archivo .pl ",-1)])],8,as),e("input",{ref_key:"fileInput",ref:t,type:"file",accept:".pl",style:{display:"none"},onChange:B},null,544)])]),n.value?(m(),f("div",{key:0,class:E(["alert",{"alert-success":s.value==="success","alert-danger":s.value==="danger","alert-warning":s.value==="warning"}]),role:"alert"},v(i.value),3)):A("",!0),e("div",ns,[o[6]||(o[6]=e("div",{class:"col-md-3"},[e("div",{class:"card bg-primary text-white"},[e("div",{class:"card-body"},[e("h5",null,"1"),e("small",null,"Archivo Activo")])])],-1)),e("div",ls,[e("div",is,[e("div",ds,[e("h5",null,v(p.value.rules),1),o[3]||(o[3]=e("small",null,'Reglas (≈ conteo ":-")',-1))])])]),e("div",rs,[e("div",cs,[e("div",us,[e("h5",null,v(b(p.value.size)),1),o[4]||(o[4]=e("small",null,"Tamaño",-1))])])]),e("div",ms,[e("div",vs,[e("div",ps,[e("h5",null,v(l(p.value.updatedAt)),1),o[5]||(o[5]=e("small",null,"Última actualización",-1))])])])]),e("div",bs,[e("div",gs,[e("div",fs,[e("table",ys,[o[11]||(o[11]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Nombre"),e("th",null,"Reglas"),e("th",null,"Tamaño"),e("th",null,"Fecha"),e("th",null,"Acciones")])],-1)),e("tbody",null,[e("tr",null,[e("td",null,[o[7]||(o[7]=e("i",{class:"fas fa-file-code me-2 text-primary"},null,-1)),w(" "+v(h.value.name),1)]),e("td",null,v(p.value.rules),1),e("td",null,v(b(p.value.size)),1),e("td",null,v(l(p.value.updatedAt)),1),e("td",null,[e("button",{class:"btn btn-sm btn-outline-info me-2",onClick:D,"data-bs-toggle":"modal","data-bs-target":"#fileViewModal"},[...o[8]||(o[8]=[e("i",{class:"fas fa-eye"},null,-1),e("span",null,"ver Archivo",-1)])]),e("a",{class:"btn btn-sm btn-outline-success",href:`${Q(d)}/admin/basepl/download`},[...o[9]||(o[9]=[e("i",{class:"fas fa-download"},null,-1),e("span",null,"Descargar",-1)])],8,hs)])]),u.value?(m(),f("tr",_s,[...o[10]||(o[10]=[e("td",{colspan:"5"},"Cargando...",-1)])])):A("",!0)])])])])]),e("div",$s,[e("div",ws,[e("div",Ms,[e("div",Cs,[e("h5",Ss,v(h.value.name),1),o[12]||(o[12]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"},null,-1))]),e("div",xs,[e("pre",ks,v(y.value),1)]),o[13]||(o[13]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Cerrar ")],-1))])])])]))}}),Ds={class:"modal fade",id:"contraModal",tabindex:"-1","aria-labelledby":"contraModalLabel","aria-hidden":"true"},Ns={class:"modal-dialog"},As={class:"modal-body"},Bs={class:"mb-3"},Ls={class:"mb-3"},Ts={class:"mb-3"},Vs={key:0,class:"text-danger"},Is=L({__name:"ContraModal",props:{contra:{},isEditing:{type:Boolean}},emits:["save"],setup(_,{emit:d}){const u=_,y=d,t=O({medication_id:"",type:"",value:""}),r=c();G(()=>u.contra,n=>{n?Object.assign(t,n):(t.medication_id="",t.type="",t.value="")},{immediate:!0});function h(){if(r.value=void 0,!t.medication_id.trim()){r.value="ID de medicamento requerido";return}if(!/^[a-z0-9_]+$/.test(t.medication_id)){r.value="ID de medicamento inválido (usa minúsculas, números y _)";return}if(!t.type){r.value="Tipo requerido";return}if(!t.value.trim()){r.value="Valor requerido";return}y("save",{...t})}function p(){t.medication_id="",t.type="",t.value="",r.value=void 0}return I(()=>{document.getElementById("contraModal")?.addEventListener("hidden.bs.modal",p)}),q(()=>{document.getElementById("contraModal")?.removeEventListener("hidden.bs.modal",p)}),(n,s)=>(m(),f("div",Ds,[e("div",Ns,[e("form",{class:"modal-content",onSubmit:R(h,["prevent"])},[s[8]||(s[8]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"contraModalLabel"}," Nueva Contraindicación "),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Cerrar"})],-1)),e("div",As,[e("div",Bs,[s[3]||(s[3]=e("label",{class:"form-label"},"ID de Medicamento",-1)),M(e("input",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=i=>t.medication_id=i),required:"",placeholder:"ibuprofeno"},null,512),[[x,t.medication_id]]),s[4]||(s[4]=e("small",{class:"text-muted"},"Debe existir en el catálogo de medicamentos.",-1))]),e("div",Ls,[s[6]||(s[6]=e("label",{class:"form-label"},"Tipo",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=i=>t.type=i),required:""},[...s[5]||(s[5]=[e("option",{value:""},"Seleccione",-1),e("option",{value:"alergia"},"Alergia",-1),e("option",{value:"cronica"},"Crónica",-1)])],512),[[z,t.type]])]),e("div",Ts,[s[7]||(s[7]=e("label",{class:"form-label"},"Valor",-1)),M(e("input",{class:"form-control","onUpdate:modelValue":s[2]||(s[2]=i=>t.value=i),required:"",placeholder:"penicilina (si es alergia) / hipertension (si es crónica)"},null,512),[[x,t.value]])]),r.value?(m(),f("small",Vs,v(r.value),1)):A("",!0)]),s[9]||(s[9]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Cancelar"),e("button",{type:"submit",class:"btn btn-primary"},"Crear")],-1))],32)])]))}}),js={class:"card mb-4"},Us={class:"card-body"},zs={class:"row g-2"},qs={class:"col-md-4"},Fs={class:"col-md-4"},Hs={class:"card"},Os={class:"card-body"},Gs={class:"table-responsive"},Rs={class:"table table-hover"},Ps={key:0},Ws={key:1},Ks={class:"badge bg-info"},Qs=["onClick"],Js=L({__name:"ContraManager",setup(_){const d=c([]),u=c(""),y=c(""),t=c(null),r=c(!1),h=c(!1),p=c(!1),n=c("success"),s=c("");function i(a,o){n.value=a,s.value=o,p.value=!0,setTimeout(()=>p.value=!1,3e3)}const $=P(()=>{const a=u.value.toLowerCase();return d.value.filter(o=>{const g=o.medication_id.toLowerCase().includes(a)||o.value.toLowerCase().includes(a),T=!y.value||o.type===y.value;return g&&T})});function S(a){return a==="alergia"?"Alergia":a==="cronica"?"Crónica":a}async function C(){h.value=!0;try{d.value=await k.listContra()}catch(a){i("danger",a?.message||"No se pudo cargar contraindicaciones")}finally{h.value=!1}}function D(){t.value=null,r.value=!1}function N(){const a=document.getElementById("contraModal"),o=window.bootstrap?.Modal;a&&o&&(o.getInstance(a)||new o(a)).hide()}async function B(a){try{await k.createContra(a),await C(),N(),i("success","Contraindicación creada")}catch(o){i("danger",o?.message||"No se pudo crear la contraindicación")}}async function b(a){if(confirm("¿Eliminar esta contraindicación?"))try{await k.deleteContra(a.medication_id,a.type,a.value),await C(),i("success","Contraindicación eliminada")}catch(o){i("danger",o?.message||"No se pudo eliminar")}}function l(){t.value=null,r.value=!1}return I(()=>{C(),document.getElementById("contraModal")?.addEventListener("hidden.bs.modal",l)}),q(()=>{document.getElementById("contraModal")?.removeEventListener("hidden.bs.modal",l)}),(a,o)=>(m(),f("div",null,[e("div",{class:"d-flex justify-content-between align-items-center mb-4"},[o[3]||(o[3]=e("h2",{class:"h4 mb-0"},"Gestión de Contraindicaciones",-1)),e("button",{class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#contraModal",onClick:D},[...o[2]||(o[2]=[e("i",{class:"bi bi-plus-circle me-2"},null,-1),w(" Nueva Contraindicación ",-1)])])]),p.value?(m(),f("div",{key:0,class:E(["alert",{"alert-success":n.value==="success","alert-danger":n.value==="danger","alert-warning":n.value==="warning"}]),role:"alert"},v(s.value),3)):A("",!0),e("div",js,[e("div",Us,[e("div",zs,[e("div",qs,[M(e("input",{"onUpdate:modelValue":o[0]||(o[0]=g=>u.value=g),type:"text",class:"form-control",placeholder:"Buscar por medicamento o valor..."},null,512),[[x,u.value]])]),e("div",Fs,[M(e("select",{"onUpdate:modelValue":o[1]||(o[1]=g=>y.value=g),class:"form-select"},[...o[4]||(o[4]=[e("option",{value:""},"Todos los tipos",-1),e("option",{value:"cronica"},"Crónica",-1),e("option",{value:"alergia"},"Alergia",-1)])],512),[[z,y.value]])])])])]),e("div",Hs,[e("div",Os,[e("div",Gs,[e("table",Rs,[o[8]||(o[8]=e("thead",{class:"table-primary"},[e("tr",null,[e("th",null,"Medicamento"),e("th",null,"Tipo"),e("th",null,"Valor"),e("th",{style:{width:"160px"}},"Acciones")])],-1)),e("tbody",null,[h.value?(m(),f("tr",Ps,[...o[5]||(o[5]=[e("td",{colspan:"4"},"Cargando...",-1)])])):$.value.length===0?(m(),f("tr",Ws,[...o[6]||(o[6]=[e("td",{colspan:"4"},"No hay contraindicaciones",-1)])])):(m(!0),f(F,{key:2},H($.value,g=>(m(),f("tr",{key:g.medication_id+"-"+g.type+"-"+g.value},[e("td",null,[e("span",Ks,v(g.medication_id),1)]),e("td",null,[e("span",{class:E(["badge",g.type==="alergia"?"bg-warning":"bg-danger"])},v(S(g.type)),3)]),e("td",null,v(g.value),1),e("td",null,[e("button",{class:"btn btn-sm btn-outline-danger",onClick:T=>b(g)},[...o[7]||(o[7]=[e("i",{class:"bi bi-trash"},null,-1),e("span",null,"Eliminar",-1)])],8,Qs)])]))),128))])])])])]),U(Is,{contra:t.value,"is-editing":r.value,onSave:B},null,8,["contra","is-editing"])]))}}),Xs={name:"AdminView",emits:["logout"],components:{AdminSidebar:se,AdminHeader:ae,DashboardStats:Be,DiseasesManager:it,MedicinesManager:Dt,SymptomsManager:es,FilesManager:Es,ContraManager:Js},setup(){const _=X();return{Onlogout:()=>{console.log("Si entra aqui"),J(),_.push({name:"home"}),window.location.href="/",console.log("Cerrando sesión...")}}},data(){return{activeSection:"dashboard"}},methods:{handleSectionChange(_){this.activeSection=_}}},Ys={class:"d-flex"},Zs={class:"flex-grow-1"},eo={class:"p-4"};function to(_,d,u,y,t,r){const h=V("AdminSidebar"),p=V("AdminHeader"),n=V("DashboardStats"),s=V("SymptomsManager"),i=V("MedicinesManager"),$=V("DiseasesManager"),S=V("ContraManager"),C=V("FilesManager");return m(),f("div",Ys,[U(h,{"active-section":t.activeSection,onSectionChange:r.handleSectionChange},null,8,["active-section","onSectionChange"]),e("div",Zs,[U(p,{onLogout:y.Onlogout},null,8,["onLogout"]),e("main",eo,[t.activeSection==="dashboard"?(m(),j(n,{key:0})):t.activeSection==="symptoms"?(m(),j(s,{key:1})):t.activeSection==="medicines"?(m(),j(i,{key:2})):t.activeSection==="diseases"?(m(),j($,{key:3})):t.activeSection==="contraindications"?(m(),j(S,{key:4})):t.activeSection==="files"?(m(),j(C,{key:5})):A("",!0)])])])}const ao=K(Xs,[["render",to]]);export{ao as default};
